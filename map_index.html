<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mapa interactivo - The Four Corners</title>
  <style>
    body{font-family:EB Garamond, serif; background:#f2efe4; color:#2d2920; margin:0; padding:24px; display:flex;flex-direction:column;align-items:center;}
    .wrap{max-width:1200px;width:100%;}
    h1{margin:0 0 12px 0;font-size:20px;text-align:center}
    p.note{margin:0 0 16px 0;text-align:center;color:#514937}
  .image-wrap{background:#fff;border:1px solid #d0c7b3;padding:12px;border-radius:6px;display:flex;justify-content:center; position:relative}
    img.responsive{max-width:100%;height:auto;display:block}
    footer{margin-top:18px;font-size:13px;color:#6b5d47}
  /* illumination for clickable zones (more visible) */
  .area-overlay{
    position:absolute;
    pointer-events:none;
    /* brown fill so clickable zones are distinct from yellow "government seat" highlights */
    background: rgba(120,80,45,0.28); /* warm parchment-brown */
    border-radius:6px;
    border:2px solid rgba(100,60,35,0.92);
    box-shadow: 0 8px 20px rgba(80,52,30,0.12), inset 0 1px 0 rgba(255,255,255,0.06);
    transition: transform .18s ease, opacity .28s ease;
    z-index:9990; /* keep below modal (9999) so popups appear above overlays */
  }
  .area-overlay.soft{ filter: drop-shadow(0 8px 18px rgba(0,0,0,0.12)); }
  /* flash to draw attention when overlays are created */
  .area-overlay.flash{ animation: overlayFlash 900ms ease forwards }
  @keyframes overlayFlash{ 0%{ transform:scale(0.98); opacity:0 } 50%{ transform:scale(1.03); opacity:1 } 100%{ transform:scale(1); opacity:0.96 } }
  /* Modal / popup styling - parchment / pergamino look */
  .region-modal { display:none; }
  .region-modal-backdrop { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.22); z-index:9998; }

  /* parchment panel */
  .region-modal-content {
    display:none;
    position:fixed;
    z-index:9999;
    padding:18px 20px;
    border-radius:8px;
    max-width:420px;
    pointer-events:auto;
    /* layered background: warm paper + subtle fiber texture */
    background:
      linear-gradient(180deg, #fff7e6 0%, #f7e6c7 60%, #f1dec1 100%),
      repeating-linear-gradient(135deg, rgba(0,0,0,0.02) 0 1px, transparent 1px 8px);
    /* reduced border for a cleaner parchment edge */
    border:2px solid rgba(75,56,38,0.28);
    box-shadow:
      0 18px 44px rgba(10,7,5,0.28), /* outer drop */
      inset 0 6px 12px rgba(255,255,255,0.12), /* highlight */
      inset 0 -6px 14px rgba(0,0,0,0.04); /* inner depth */
    overflow:hidden;
  }

  /* subtle 'burnt' / irregular edge suggestion using pseudo-elements */
  /* decorative pseudo-elements removed to avoid circular artifacts */
  .region-modal-content::before,
  .region-modal-content::after { display:none; }

  .region-modal-content h3 {
    margin:0 0 10px 0;
    font-size:18px;
    color:#4b3826;
    letter-spacing:0.2px;
    text-shadow: 0 1px 0 rgba(255,255,255,0.45);
  }

  .region-modal-content #regionModalBody {
    max-height:260px;
    overflow:auto;
    color:#2b2419;
    line-height:1.55;
    font-size:14px;
    padding-right:8px; /* give room for a custom scrollbar */
    scrollbar-width: thin; /* Firefox */
    scrollbar-color: #b6864a rgba(0,0,0,0.04);
  }
  /* WebKit-based browsers (Chrome, Edge, Safari) */
  .region-modal-content #regionModalBody::-webkit-scrollbar{ width:12px; height:12px }
  .region-modal-content #regionModalBody::-webkit-scrollbar-track{
    background: linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.01));
    border-radius:10px; margin:6px 0;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.04);
  }
  .region-modal-content #regionModalBody::-webkit-scrollbar-thumb{
    background: linear-gradient(180deg,#c9a66a,#a8733f);
    border-radius:10px; border:3px solid rgba(0,0,0,0.03);
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.14);
  }
  .region-modal-content #regionModalBody::-webkit-scrollbar-thumb:hover{
    background: linear-gradient(180deg,#d8b57f,#b07a45);
  }
  /* add a subtle focus ring when keyboard focusing the scrollable content */
  .region-modal-content #regionModalBody:focus{
    outline: 3px solid rgba(184,124,58,0.12);
    outline-offset:2px;
  }

  /* Improved typography for modal content */
  .region-modal-content{
    font-family: 'EB Garamond', Georgia, serif;
    -webkit-font-smoothing:antialiased;
    text-rendering:optimizeLegibility;
    font-size:15px;
    color: #2b2419;
  }
  .region-modal-content p{ margin:0 0 10px 0; text-align:justify; text-justify:inter-word; }
  .region-modal-content i, .region-modal-content em{
    display:block;
    background: rgba(139,111,74,0.04);
    padding:8px 10px;
    margin: -8px 0 10px 0;
    border-left:4px solid rgba(139,111,74,0.12);
    color:#4a3826;
    font-style:italic;
  }
  .region-modal-content strong{ color:#3b2b1f; font-weight:700; }
  .region-modal-content blockquote{ margin:8px 0 12px 0; padding:10px 12px; background:rgba(0,0,0,0.03); border-left:4px solid #8b6f4a; color:#332a20; }
  .region-modal-content ul, .region-modal-content ol{ margin:8px 0 12px 24px; }
  .region-modal-content .meta{ display:block; font-size:13px; color:#6b5d47; margin-bottom:8px }
  /* ensure scrollbar has breathing room */
  .region-modal-content #regionModalBody{ padding-right:6px }

  /* flatter parchment-close button */
  .modal-close {
    position:absolute;
    right:12px;
    top:10px;
    background: transparent;
    color: #3b2b1f;
    border:0;
    width:28px;
    height:28px;
    border-radius:4px;
    font-size:18px;
    font-weight:700;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow: none;
    transition: background .12s ease, transform .08s ease;
    z-index: 10020; /* ensure button sits above decorative pseudo-elements */
  }
  .modal-close:hover{ background: rgba(75,56,38,0.06); transform:translateY(-1px) scale(1.02) }

  /* small responsive tweak so very narrow screens still see content comfortably */
  @media (max-width:420px){
    .region-modal-content{ left:10px; right:10px; max-width:calc(100% - 20px); border-width:4px; }
  }
  /* Highlight overlay for clicked areas (persistent, multi-highlight) */
  .map-highlight{ position:absolute; pointer-events:none; border:3px solid rgba(255,200,80,0.98); box-shadow:0 0 30px rgba(255,200,80,0.9); border-radius:8px; transform-origin:center; z-index:9997; opacity:1; transition: opacity 0.6s ease, transform 0.3s ease; }
  /* small pulse while visible */
  .map-highlight.pulse{ animation:highlightPulse 1.6s ease-out infinite; }
  @keyframes highlightPulse{ 0%{ transform:scale(0.995) } 50%{ transform:scale(1.02) } 100%{ transform:scale(0.995) } }
  </style>


</head>
<body>
  <div class="wrap">
    <h1>Fanmade interactive map — Worldbuilders</h1>
    <p class="note">Haz clic o toca las zonas del mapa para ver sus nombres. El mapa se escala automáticamente en pantallas pequeñas.</p>

    <div class="image-wrap">
      <img id="mapImg" class="responsive" src="worldbuilders.png" alt="Four Corners of Civilization - Worldbuilders" usemap="#image-map">
    </div>

    <map name="image-map">
        <area target="" alt="Haeth" title="Haeth" href="#" coords="278,440,203,405" shape="rect">
        <area target="" alt="Ademre" title="Ademre" href="#" coords="329,507,183,471" shape="rect">
        <area target="" alt="Modeg" title="Modeg" href="#" coords="487,579,644,617" shape="rect">
        <area target="" alt="Khershaen" title="Khershaen" href="#" coords="461,633,604,663" shape="rect">
        <area target="" alt="Vishanti" title="Vishanti" href="#" coords="559,701,654,746" shape="rect">
        <area target="" alt="The Eld" title="The Eld" href="#" coords="713,726,817,788" shape="rect">
        <area target="" alt="Vintas" title="Vintas" href="#" coords="878,390,1027,435" shape="rect">
        <area target="" alt="The Free City of Tinue" title="The Free City of Tinue" href="#" coords="649,419,770,465" shape="rect">
        <area target="" alt="Severen" title="Severen" href="#" coords="856,493,776,466" shape="rect">
        <area target="" alt="Renere" title="Renere" href="#" coords="900,478,987,513" shape="rect">
        <area target="" alt="The Small Kingdoms" title="The Small Kingdoms" href="#" coords="918,765,1099,822" shape="rect">
        <area target="" alt="Junpui" title="Junpui" href="#" coords="1062,924,1165,952" shape="rect">
        <area target="" alt="Atur" title="Atur" href="#" coords="641,937,698,969" shape="rect">
        <area target="" alt="The Aturan Empire" title="The Aturan Empire" href="#" coords="521,985,636,1063" shape="rect">
        <area target="" alt="Anilin" title="Anilin" href="#" coords="700,1209,778,1236" shape="rect">
        <area target="" alt="Fordell" title="Fordell" href="#" coords="866,1508,780,1472" shape="rect">
        <area target="" alt="Imre" title="Imre" href="#" coords="784,1376,842,1396" shape="rect">
        <area target="" alt="Tarbean" title="Tarbean" href="#" coords="859,1375,950,1416" shape="rect">
        <area target="" alt="The University" title="The University" href="#" coords="766,1411,874,1434" shape="rect">
        <area target="" alt="Yll" title="Yll" href="#" coords="1200,1477,1269,1512" shape="rect">
        <area target="" alt="Commonwealth" title="Commonwealth" href="#" coords="745,1557,1093,1585" shape="rect">
        <area target="" alt="Ceald" title="Ceald" href="#" coords="380,1640,512,1681" shape="rect">
        <area target="" alt="Calderero" title="Calderero" href="#" coords="1218,272,91" shape="circle">
        <area target="" alt="Goverment Seat" title="Goverment Seat" href="#" coords="1331,465,1146,440" shape="rect">
        <area target="" alt="Farrowton Sisters" title="Farrowton Sisters" href="#" coords="1340,737,1241,598" shape="rect">
        <area target="" alt="Vesumbi Islands" title="Vesumbi Islands" href="#" coords="842,1895,946,1949" shape="rect">
        <area target="" alt="Ralien" title="Ralien" href="#" coords="496,1528,579,1573" shape="rect">
        <area target="" alt="Great Stone Road" title="Great Stone Road" href="" coords="771,1126,707,921" shape="rect">
        <area target="" alt="North" title="North" href="" coords="1054,254,1121,304" shape="rect">
        <area target="" alt="Sanshole" title="Sanshole" href="" coords="739,1602,847,1625" shape="rect">
        <area target="" alt="Anilin" title="Anilin" href="" coords="699,1214,780,1237" shape="rect">
        <area target="" alt="Dalonir" title="Dalonir" href="" coords="541,1438,636,1408" shape="rect">
    </map>

    <footer>
      <p>Nota: las áreas usan coordenadas en el tamaño original de la imagen. La página escala las coordenadas cuando el ancho del navegador cambia.</p>
    </footer>
    <!-- Modal for region info -->
    <div id="regionModal" class="region-modal" aria-hidden="true">
      <div class="region-modal-backdrop" id="modalBackdrop"></div>
      <div class="region-modal-content" role="dialog" aria-modal="true" aria-labelledby="regionModalTitle">
  <button id="modalClose" class="modal-close" aria-label="Cerrar">
    <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true" focusable="false" xmlns="http://www.w3.org/2000/svg">
      <line x1="4" y1="4" x2="20" y2="20" stroke="#3b2b1f" stroke-width="2.2" stroke-linecap="round" />
      <line x1="20" y1="4" x2="4" y2="20" stroke="#3b2b1f" stroke-width="2.2" stroke-linecap="round" />
    </svg>
  </button>
        <h3 id="regionModalTitle"></h3>
        <div id="regionModalBody"></div>
      </div>
    </div>
  </div>

  <script>
    // Make the image map responsive by scaling area coords based on image clientWidth / naturalWidth
    (function(){
      const img = document.getElementById('mapImg');
      const areas = Array.from(document.querySelectorAll('map[name="image-map"] area'));
      // store original coords
      areas.forEach(a => {
        a.dataset.orig = a.getAttribute('coords');
      });

      function resizeMap(){
        const scale = img.naturalWidth ? (img.clientWidth / img.naturalWidth) : 1;
        areas.forEach(a => {
          const orig = (a.dataset.orig||"").split(',').map(n=>parseFloat(n)||0);
          const scaled = orig.map(n=>Math.round(n*scale));
          a.coords = scaled.join(',');
        });
      }

      // debounce resize
      let t;
      window.addEventListener('resize', ()=>{ clearTimeout(t); t = setTimeout(resizeMap,120); });
      if (img.complete) resizeMap(); else img.addEventListener('load', resizeMap);

      // Create lighting overlays for clickable areas
      function createAreaOverlays(){
        const wrap = document.querySelector('.image-wrap');
        // remove previous overlays
        wrap.querySelectorAll('.area-overlay').forEach(n=>n.remove());
        const scaleX = img.naturalWidth ? (img.clientWidth / img.naturalWidth) : 1;
        const scaleY = img.naturalHeight ? (img.clientHeight / img.naturalHeight) : scaleX;
        const seen = new Set();
        areas.forEach(a => {
          const orig = (a.dataset.orig||a.getAttribute('coords')||"").split(',').map(n=>parseFloat(n)||0);
          const title = (a.getAttribute('title')||a.getAttribute('alt')||'').trim();
          if (title && seen.has(title)) return; // skip duplicate-named areas
          if (title) seen.add(title);
          if (!orig.length) return;
          let left, top, width, height;
          if (orig.length >= 4) {
            const [x1,y1,x2,y2] = orig;
            const rx = Math.min(x1,x2), ry = Math.min(y1,y2);
            left = img.offsetLeft + (rx * scaleX);
            top = img.offsetTop + (ry * scaleY);
            width = Math.max(6, Math.abs(x2-x1) * scaleX);
            height = Math.max(6, Math.abs(y2-y1) * scaleY);
          } else if (orig.length === 3) {
            const [cx,cy,r] = orig;
            left = img.offsetLeft + ((cx - r) * scaleX);
            top = img.offsetTop + ((cy - r) * scaleY);
            width = (r * 2) * scaleX; height = (r * 2) * scaleY;
          } else return;
          const ov = document.createElement('div');
          ov.className = 'area-overlay soft';
          if (title) ov.dataset.title = title;
          ov.setAttribute('aria-hidden','true');
          // add a tiny inset so overlays don't perfectly cover borders
          Object.assign(ov.style, { left: left + 'px', top: top + 'px', width: width + 'px', height: height + 'px', opacity: '0.96' });
          wrap.appendChild(ov);
          // small flash to draw attention
          requestAnimationFrame(()=>{ ov.classList.add('flash'); setTimeout(()=>ov.classList.remove('flash'), 900); });
        });
      }

      // ensure overlays update with resized image
      window.addEventListener('resize', ()=>{ clearTimeout(t); t = setTimeout(()=>{ resizeMap(); createAreaOverlays(); },120); });
      if (img.complete) createAreaOverlays(); else img.addEventListener('load', createAreaOverlays);

      // optional: show a tooltip-like alert for clicks
      areas.forEach(a=>{
          a.addEventListener('click', (ev)=>{
            ev.preventDefault();
            const name = a.getAttribute('title') || a.getAttribute('alt') || 'Zona';
            // Special behaviour: if user clicked the Goverment Seat, highlight Tarbean, Ralien, and Khershaen
            if (name === 'Goverment Seat') {
              const toHighlight = ['Tarbean','Ralien','Khershaen','Renere'];
              toHighlight.forEach(t=> highlightAreaByTitle(t));
            }
            // show modal next to click if we have info, otherwise floating label
            if (regionInfo[name]) showModal(name, regionInfo[name], ev.clientX, ev.clientY);
            else showLabel(ev.clientX, ev.clientY, name);
          })
      });

      //highlight (w scaled coords)
      function highlightAreaByTitle(title){
        const target = areas.find(x => (x.getAttribute('title')||x.getAttribute('alt')) === title);
        if (!target) return;
        const origCoords = (target.dataset.orig||target.getAttribute('coords')||"").split(',').map(n=>parseFloat(n)||0);
        if (!origCoords.length) return;
        const wrap = document.querySelector('.image-wrap');
        const scaleX = img.naturalWidth ? (img.clientWidth / img.naturalWidth) : 1;
        const scaleY = img.naturalHeight ? (img.clientHeight / img.naturalHeight) : scaleX;
        let left, top, width, height;
        if (origCoords.length >= 4) {
          const [x1,y1,x2,y2] = origCoords;
          const rx = Math.min(x1,x2), ry = Math.min(y1,y2);
          left = img.offsetLeft + (rx * scaleX);
          top = img.offsetTop + (ry * scaleY);
          width = Math.abs(x2 - x1) * scaleX;
          height = Math.abs(y2 - y1) * scaleY;
        } else if (origCoords.length === 3) {
          const [cx,cy,r] = origCoords;
          left = img.offsetLeft + ((cx - r) * scaleX);
          top = img.offsetTop + ((cy - r) * scaleY);
          width = (r * 2) * scaleX;
          height = (r * 2) * scaleY;
        } else {
          return;
        }

        // allow multiple highlights; create a new one for each call
        const h = document.createElement('div');
        h.className = 'map-highlight pulse';
        Object.assign(h.style, { left: left + 'px', top: top + 'px', width: width + 'px', height: height + 'px' });
        wrap.appendChild(h);
        // keep visible for 8s, then fade and remove
        setTimeout(()=>{ h.classList.remove('pulse'); h.style.opacity = '0'; setTimeout(()=>h.remove(), 600); }, 8000);
      }

      // Region info mapping 
      const regionInfo = {
        'Modeg': '<p> <i>Language: Modegan. In an interview Pat said "Magic works differently there" also "there is no royalty older than the Modegan royal line"</i>We know nothing about their currency aside from the word “strehlaums”, and every other currency is rather detailed in the 10th anniversary edition. Plus, there is no Modegan campfire in Sceop’s story, and the only stereotype we get from there is that, again, they’re quite promiscuous. <br>We dont know much about Modeg, but weve gotten glimpses of their religion. Fela and Sovoy are both Modegan. Fela says "tiny gods" and Sovoy (and Bredon) says "gods all around us." IRL there was a playing card that Pat shared of the Modegan "hollow gods" which featured a tree with eyes. Also in the prologue of *Laniel Young-Again* that he shared there are "tall gods" and describes the god as a tree with branches reaching to they sky. Note: Tall is a homophone of "Tahl" and its been theorized that those meanings have been mixed in various stories. Note2: The transcript of Laniel Young-Again has some errors. We know from other cards/interviews that its not a "Sivel House" but actually a "Cimbrel House" which is where Cimbrelines work - the official name for the Modegan "ladies" who earn their stripes. They literally have an education that allows them to earn up to ten stripes. </p>',
        'Atur': '<p> Atur is marked as a notable city, but not a government seat. <i>in Felior´s Fall there are a full thirteen (Chandrian): one for each pontifet in Atur, and an extra for the capitol.</i></p>',
        'Goverment Seat': '<p>This are the major cities: Tarbean, Renere, Ralien, and Khershaen, posibly THE 4 corners. They are usually associated with: <br> Commonwealth: understanding, art. Imre and the University.<br>Ceald: wealth, trade, industry; famous for its financial power. <br>Modeg: openness, wisdom, expressiveness; its king is described as wise, and the kingdom seems to value individuality. <br>Vintas: tradition, nobility, social rigidity; possibly the cornerstone of the conservative structure.</p>',
        'Farrowton Sisters': '<p>Cartographers who made the map in universe</p>',
        'Calderero': '<p> <i>“Tinkers are a sign of civilization.  Where the roads are safe, Tinkers travel freely, bringing welcome news and many necessary goods that are hard for to come by in small towns.” </i> All officials maps at the point of writing have included a Tinker on a corner. </p>',
        'The Aturan Empire': '<p> Language: Aturan (most spoken) <br> Note the other territories in the same color known as "Ciradats". <br>The Tehlin church is particularly powerful there, and probably originated in Atur: according to church teachings, Atur is where Tehlu bound Encanis to the wheel. Present day Aturans are seen as superstitious. Many of their dramatic works are morality plays about bargaining with demons, or dramas featuring sinister magicians.</p>',
        'Haeth': '<p>This map changes the spelling of Haert .</p>',
        'Severen': '<p>or Sevren ruled by the Maer Alveron, is divided into two chief sections: Severen-High and Severen-Low </p>',
        'Vesumbi Islands': '<p> In the Aturan Empire map the spelling is "V´ Sumbi Isles". Vi Sembi raiders are known to attack towns with flint and obsidian arrows. It\'s possible that they\'re from the Vesumbi Islands.</p>',
     'Ceald': '<p>Its history stretches back two thousand years, to when Heldred united the previously nomadic peoples of the Shalda mountains. The Cealdim were the first to establish a standardized currency, and to the present day Cealdish currency can be used throughout the Four Corners. <i>"...most moneylenders are Cealdish</i> <br> <strong>Language:</strong> Siaru <br> Cealdim is composed of two groups, the Cealdim and Cealdar. The Cealdim appear to be the richer merchant class and money-lenders. The Cealdar were made of the workers in the workshops. The groups got their names from the original founder of the country. The nomadic folk who roamed the Shalda mountains were united under Heldred who had two sons Heldim and Heldar. </p>',
     'Ralien': '<p> <i>“I was a city-licensed escort from Ralien. A grateful Cealdish merchant gave me money to start an inn. His name is Deolan. We were traveling from Purvis.”</i></p>',
     'Great Stone Road': '<p> It would be against the law to deface any part of the Great Stone Road/Old Stonebridge/Waystones. This is one of the things that a Ciridae could do with impunity. This crime was equivalent to strangling a pregnant woman or burning a church. </p>',
     'Vintas': '<p>Feyda Calanthis was post-humously declared the first king of Tarvintas, later Vintas. He was the start of the royal Calanthis line, where currently Roderic is king and Rinne is queen. Feyda was powerful, magical, and his image is on the Vintish Penny. If you break a Vintish penny into a ha\'penny you are supposed to let the other person in the transaction pick which half of the penny they want, as good manners. Half of the penny shows Feyda as a live king, and half as a Draugar king. </p>',
     'Yll': '<p>Yll is said to have a milder climate by Denna, as its the first winter where her lungs have not acted up. <i>"For tomorrow, you can prepare a report on Yll’s lunar calendar compared to the more accurate, civilized Aturan calendar that you should be familiar with by now."    </i> </p>',
     'North': '<p>There is no magnetic north in Temerant. The tri-foil compass points to three artificial points that arcanists created in the past, as a form of monopoly.</p>',
     'The Small Kingdoms': '<p> <i>“Only priests and fools” expect the roads in the Small Kingdoms to be safe."</i>It is likely many different kingdoms, since the boy with a gold screw in his belly button visits "each of the small kingdoms".Kvothe spent a short amount of time stranded in Junpui while on his way to Severen, where he begged for crusts, stole a mans shoes, and recited poetry. Vashet spent four years as a captain and bodyguard to a "poet king" in the Small Kingdoms. Caudicus claimed that a large portion of the land which is now the Small Kingdoms was once ruled by the Lackless family. </p>',
     'The Free City of Tinue': '<p> It was once part of an earldom controlled by the <strong>Lackless family</strong>, until a rebellion took control of the city away from them. <br> It is a common Aturan expression to ask "how is the road to Tinuë?", and it\'s believed that all the roads in the Four Corners will eventually pass through the city. <br> It might be <strong>Tinusa</strong>, the city that survived the Creation War. </p>',
     'Sanshole': '<p> Theories say this is probably the town that Kvothe´s trope was leaving before being attacked, considering distance and location (north of Tarbean)  </p>',
     'Anilin': '<p> <i>“You could come to Anilin with us,” she suggested. “They say the streets are paved with gold there."</i> Probably a industrial city, see the connection with the chemical compound "Aniline" (used for hairdyes and fuel that burns blue) and is in route for Kvothe when he describes: <i>"Eventually we came to another stream crossing the road. Not much more than a foot deep at the most. The water had a sharp, foul smell that let me know there was a tannery upstream, or a refinery (...) Solvents and acids. If not a refinery, then at least a mine."</i> Other mentions:<br><i>“The fire was blue last night?” She nodded. “Like a coal-gas flame. Like the lamps they have in Anil<strong>e</strong>n.”</i> <i>“What happened in Anilin, anyway?” A leaf floated down and landed in her hair. She brushed it away absentmindedly. “Nothing pleasant,” she said, avoiding my eyes. “But nothing unexpected either.”</i><i> “Like hell. Check it now, while he’s close. We’ve lost him twice already. I’m not having another cock-up like in Anilin.”</i> </p>',
     'Dalonir': '<p> At the beginning of ch.39 of The WMF Wilem says that Dalonir is Simmon´s father´s dutchy in the north of Aturan ... but here Dalonir appears to be Ceald. When asked Pat was unsure of the sitation.</p>',
     'Junpui': '<p> <i> Over the course of my trip I was robbed, drowned, and left penniles on the streets of Junpui </i> Books in the archives record a story of an Amyr putting down a peasant uprising in Junpui. <br>In Junpui the punishment for forgery is being thrown into a fire.</p>',
};
      // Modal functions and elements
      const modal = document.getElementById('regionModal');
      const modalContent = modal.querySelector('.region-modal-content');
      const modalTitle = document.getElementById('regionModalTitle');
      const modalBody = document.getElementById('regionModalBody');
      const modalClose = document.getElementById('modalClose');
      const modalBackdrop = document.getElementById('modalBackdrop');

      function showModal(title, html, clientX=null, clientY=null) {
        modalTitle.textContent = title;
        modalBody.innerHTML = html;
        // show backdrop and content so we can measure
        modalBackdrop.style.display = 'block';
        modal.style.display = 'block';
        modalContent.style.display = 'block';
        modal.setAttribute('aria-hidden','false');

        // position the popup near the click (clamped to viewport)
        requestAnimationFrame(()=>{
          const rect = modalContent.getBoundingClientRect();
          let left = (clientX != null) ? (clientX + 12) : (window.innerWidth - rect.width)/2;
          // if overflow right, place left of click
          if (left + rect.width > window.innerWidth - 12 && clientX != null) left = clientX - rect.width - 12;
          if (left < 12) left = 12;
          let top = (clientY != null) ? (clientY - rect.height/2) : (window.innerHeight - rect.height)/2;
          if (top < 12) top = 12;
          if (top + rect.height > window.innerHeight - 12) top = window.innerHeight - rect.height - 12;
          modalContent.style.left = left + 'px';
          modalContent.style.top = top + 'px';
        });
      }
      function closeModal(){
        modalBackdrop.style.display = 'none';
        modal.style.display = 'none';
        modalContent.style.display = 'none';
        modal.setAttribute('aria-hidden','true');
      }
      modalClose.addEventListener('click', closeModal);
      modalBackdrop.addEventListener('click', closeModal);
      window.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') closeModal(); });

      function showLabel(x,y,text){
        const existing = document.querySelector('.map-label'); if (existing) existing.remove();
        const d = document.createElement('div');
        d.className='map-label';
        d.textContent = text;
        Object.assign(d.style,{position:'fixed',left:(x+8)+'px',top:(y+8)+'px',background:'#222',color:'#fff',padding:'6px 8px',borderRadius:'6px',zIndex:9999,fontSize:'13px',pointerEvents:'none'});
        document.body.appendChild(d);
        setTimeout(()=>d.remove(),1200);
      }
    })();
  </script>
</body>
</html>